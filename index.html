<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description"
        content="Negative Token Merging: Image-based Adversarial Feature Guidance">
  <meta name="keywords" content="token merging, negative token merging, diversity, copyright, negative prompt, diffusion models">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Negative Token Merging: Image-based Adversarial Feature Guidance</title>

  <!-- Global site tag (gtag.js) - Google Analytics
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PYVRSFMDRL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-PYVRSFMDRL');
  </script> -->

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <!-- <link rel="icon" href="./static/images/favicon.svg"> -->
  <link href="/assets/images/icon.png" rel="icon" sizes="32x32" type="image/png">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>
  <!-- <script src="./static/js/target.js"></script> -->
  <base target="_blank">
</head>
<body>


<!-- Navigation bar for visiting other research pages
<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start" style="flex-grow: 1; justify-content: center;">
      <a class="navbar-item" href="https://1jsingh.github.io/">
      <span class="icon">
          <i class="fas fa-home"></i>
      </span>
      </a>

      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link">
          More Research
        </a>
        <div class="navbar-dropdown">
            <a class="navbar-item" href="https://1jsingh.github.io/divide-evaluate-and-refine">
                Eval-and-Refine (NeurIPS-2023)
            </a>
          <a class="navbar-item" href="https://1jsingh.github.io/gradop">
            GradOP-Guided-Image-Synthesis (CVPR-2023)
          </a>
          <a class="navbar-item" href="https://1jsingh.github.io/paint2pix">
            Paint2pix (ECCV-2022)
          </a>
          <a class="navbar-item" href="https://1jsingh.github.io/intelli-paint">
            Intelli-paint (ECCV-2022)
          </a>
          <a class="navbar-item" href="https://1jsingh.github.io/semantic-guidance">
            Semantic-Guidance (CVPR-2021)
          </a>
        </div>
      </div>
    </div>

  </div>
</nav> -->


<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title"><span style="color: #007bff;"></span> Negative Token Merging: Image-based Adversarial Feature Guidance </h1>
          <div class="is-size-5 publication-authors">
            <div class="is-size-5 publication-authors">
              <!-- Author List -->
              <span class="author-block">
                <a href="https://1jsingh.github.io/">Jaskirat Singh</a><sup>2</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=WR875gYAAAAJ&hl=en">Lindsey Li</a><sup>1</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?hl=en&user=zt73PHcAAAAJ">Weijia Shi</a><sup>1</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://ranjaykrishna.com/index.html">Ranjay Krishna</a><sup>1,3</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=vhP-tlcAAAAJ&hl=en">Yejin Choi</a><sup>1</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://koh.pw/">Pang Wei Koh</a><sup>1,3</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://research.facebook.com/blog/2019/7/qa-with-director-of-computational-photography-michael-f-cohen/">Michael F. Cohen</a><sup>1</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com.au/citations?user=YvdzeM8AAAAJ&hl=en">Stephen Gould</a><sup>2</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=vNHqr3oAAAAJ&hl=en">Liang Zheng</a><sup>2</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=UjpbO6IAAAAJ&hl=en">Luke Zettlemoyer</a><sup>1</sup>
              </span>
            </div>
            
            <div class="is-size-5 publication-authors">
              <!-- Institution List -->
              <span class="author-block"><sup>1</sup>University of Washington&emsp;&emsp;</span>
              <span class="author-block"><sup>2</sup>The Australian National University&emsp;&emsp;</span>
              <span class="author-block"><sup>3</sup>Allen Institute for AI</span>
            </div>

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- png Link. -->
              <!-- <span class="link-block">
                <a href=""
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                  </span>
                  <span>Paper</span>
                </a>
              </span> -->
              <!-- Arxiv Link. -->
              <span class="link-block">
                <a href="https://arxiv.org/abs/2312.05039"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="ai ai-arxiv"></i>
                  </span>
                  <span>Paper</span>
                </a>
              </span>
              <!-- Video Link. -->
              <!-- <span class="link-block">
                <a href="https://www.youtube.com/watch?v=Yk83RPCOa2o&ab_channel=anucvml"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-youtube"></i>
                  </span>
                  <span>Video</span>
                </a>
              </span> -->
              <!-- Demo Link. -->
              <span class="link-block">
                <a href="http://exposition.cecs.anu.edu.au:6009/"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                    <i class="fas fa-paint-brush"></i>
                  </span>
                  <span>Hugginface Demo ðŸ¤—</span>
                </a>
              </span>
              <!-- Code Link. -->
              <span class="link-block">
                <a href="https://github.com/1jsingh/negtome"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Code</span>
                  </a>
              </span>
              <!-- Dataset Link. -->
              <!-- <span class="link-block">
                <a target="_self" href="#citation"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="far fa-images"></i>
                  </span>
                  <span>Cite</span>
                </a>
              </span> -->
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>



<section class="hero teaser">
  <div class="container is-max-desktop alternate-section">
    <div class="hero-body" text-align: center>
      <!-- <img src="./docs/smartmask/multi-obj-insertion-p2-v2.png" width=100%/>   -->
      <video id="teaser" autoplay muted loop playsinline height="100%">
        <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/teaser.mp4"
                type="video/mp4">
      </video>
      <h2 class=" has-text-justified">
        <br> 
              NegToMe is a simple but effective training-free approach which performs adversarial guidance by selectively pushing apart matching semantic features (between reference and output generation) during the reverse diffusion process. 
              When used w.r.t. other images in the same batch, we observe that NegToMe significantly increases output diversity (racial
      </h2>
    </div>
  </div>
</section>


<!-- <section class="hero is-light is-small">
  <div class="hero-body">
    <div class="container">
      <div id="results-carousel" class="carousel results-carousel">
        <div class="item item-steve">
          <video poster="" id="steve" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/steve.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-chair-tp">
          <video poster="" id="chair-tp" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/chair-tp.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-shiba">
          <video poster="" id="shiba" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/shiba.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-fullbody">
          <video poster="" id="fullbody" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/fullbody.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-blueshirt">
          <video poster="" id="blueshirt" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/blueshirt.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-mask">
          <video poster="" id="mask" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/mask.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-coffee">
          <video poster="" id="coffee" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/coffee.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-toby">
          <video poster="" id="toby" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/toby2.mp4"
                    type="video/mp4">
          </video>
        </div>
      </div>
    </div>
  </div>
</section> -->

<!-- sample results -->
<section class="hero is-light is-small">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <h3 class="subtitle has-text-centered">
        <b>Improving Output Diversity (Flux)</b>
      </h3>
      <div id="results-carousel" class="carousel results-carousel">
        <div class="item-simple item-steve">
          <img src="./docs/gradop/sample-results-sdedit-p5.png">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/gradop/sample-results-sdedit-p4.png">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/gradop/sample-results-sdedit-p6.png">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/gradop/sample-results-sdedit-p7.png">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/gradop/sample-results-sdedit-p1.png">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/gradop/sample-results-sdedit-p2.png">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/gradop/sample-results-sdedit-p3.png">
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop alternate-section">
    <!-- Abstract. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <br><br><h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            Text-based adversarial guidance using a negative prompt has emerged as a widely adopted approach to push the output features away from undesired concepts. 
            While useful, performing adversarial guidance using text alone can be insufficient to capture complex visual concepts and avoid undesired visual elements like copyrighted characters. 
            In this paper, for the first time we explore an alternate modality in this direction by performing adversarial guidance directly using visual features from a reference image or other images in a batch. 
            In particular, we introduce negative token merging (NegToMe), a simple but effective training-free approach which performs adversarial guidance by selectively pushing apart matching semantic features (between reference and output generation) during the reverse diffusion process. 
            When used w.r.t. other images in the same batch, we observe that NegToMe significantly increases output diversity (racial, gender, visual) without sacrificing output image quality. Similarly, when used w.r.t. a reference copyrighted asset, NegToMe helps reduce visual similarity with copyrighted content by 34.57%. 
            NegToMe is simple to implement using just few-lines of code, uses only marginally higher (<4%) inference times and generalizes to different diffusion architectures like Flux, which do not natively support the use of a separate negative prompt.
          </p>
        </div>
      </div>
    </div>
    <!--/ Abstract. -->

    <!-- Paper video. -->
    <!-- <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Video</h2>
        <div class="publication-video">
          <iframe src="https://www.youtube.com/embed/MrKrnHhk8IA?rel=0&amp;showinfo=0"
                  frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
      </div>
    </div> -->
    <!--/ Paper video. -->
</section>


<!-- other sections -->
<section class="hero">
<!-- Paper video. -->
<div class="hero-body is-small">
<div class="container alternate-section">
  <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">How does NegToMe work?</h2>
        <figure>
          <img src="./docs/smartmask/method-overview-combined-v2.png" width=100%/>
          <!-- <figcaption>Fig.1 - Trulli, Puglia, Italy.</figcaption> -->
        </figure>
        <p style="text-align:justify"> 
          <br>
          <!-- (a) Given a reference painting <emph>y</emph> and text prompt <emph>\tau_{text}</emph>, we first formulate the guided synthesis problem as the solution $x^\star$ of a constrained optimization problem with 2 properties: 1) $x^\star$ lies in the subspace $\mathcal{S}_{\tau_{text}}$ of outputs conditioned only on the text, and, 2) upon painting $x$ we should recover reference painting $y$. While computing an exact solution of this optimization is infeasible, we show that an approximation can be obtained by solving the unconstrained optimization in (b). Here we first use gradient descent to compute a point $x^\star$ close to a random sample $x_{\tau_{text}} \in \mathcal{S}_{\tau_{text}}$, while still minimizing the painting loss $\mathcal{L}(f(x),y)$. This $x^\star$ is usually non-photorealistic due to gradient descent. We therefore use the diffusion based inversion from \cite{song2020denoising} to map it back to target domain $\mathcal{S}_{\tau_{text}}$.  -->
          <!-- <figcaption> -->
          <!-- </figcaption> -->
          <br><br>
        </p>
      </div>
  </div>
</div>
</div>

<div class="hero-body is-small">
<div class="container alternate-section">
  <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Improving Output Diversity (SDXL)</h2>
        <p style="text-align:justify"><b>Comparison with prior works.</b> We observe that as compared to with state-of-the-art image inpainting methods, SmartMask allows the user to perform object insertion while better preserving the background around the inserted object
            <br><br> </p>
        <figure>
          <!-- <img src="./docs/gradop/test.png" width=100%/> -->
          <img src="./docs/smartmask/method-overview-combined-v2.png" width=100%/>
          <!-- <img src="./docs/gradop/sdedit-var-p7.png" width=100%/> -->
          <!-- <figcaption>Fig.1 - Trulli, Puglia, Italy.</figcaption> -->
        </figure>
      </div>
  </div>
</div>
</div>

<div class="hero-body is-small">
  <div class="container alternate-section">
    <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Improving Output Diversity (Flux)</h2>
          <p style="text-align:justify"><b>Comparison with prior works.</b> We observe that as compared to with state-of-the-art image inpainting methods, SmartMask allows the user to perform object insertion while better preserving the background around the inserted object
              <br><br> </p>
          <figure>
            <!-- <img src="./docs/gradop/test.png" width=100%/> -->
            <img src="./docs/smartmask/method-overview-combined-v2.png" width=100%/>
            <!-- <img src="./docs/gradop/sdedit-var-p7.png" width=100%/> -->
            <!-- <figcaption>Fig.1 - Trulli, Puglia, Italy.</figcaption> -->
          </figure>
        </div>
    </div>
  </div>
  </div>

<div class="hero-body is-small">
  <div class="container alternate-section">
    <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Improving Output Aesthetics and Details</h2>
          <p style="text-align:justify"><b>Comparison with prior works.</b> We observe that as compared to with state-of-the-art image inpainting methods, SmartMask allows the user to perform object insertion while better preserving the background around the inserted object
              <br><br> </p>
          <figure>
            <!-- <img src="./docs/gradop/test.png" width=100%/> -->
            <img src="./docs/smartmask/method-overview-combined-v2.png" width=100%/>
            <!-- <img src="./docs/gradop/sdedit-var-p7.png" width=100%/> -->
            <!-- <figcaption>Fig.1 - Trulli, Puglia, Italy.</figcaption> -->
          </figure>
        </div>
    </div>
  </div>
  </div>


<div class="hero-body is-small">
  <div class="container alternate-section">
    <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Improving Output Aesthetics and Details</h2>
          <p style="text-align:justify"><b>Comparison with prior works.</b> We observe that as compared to with state-of-the-art image inpainting methods, SmartMask allows the user to perform object insertion while better preserving the background around the inserted object
              <br><br> </p>
          <figure>
            <!-- <img src="./docs/gradop/test.png" width=100%/> -->
            <img src="./docs/smartmask/method-overview-combined-v2.png" width=100%/>
            <!-- <img src="./docs/gradop/sdedit-var-p7.png" width=100%/> -->
            <!-- <figcaption>Fig.1 - Trulli, Puglia, Italy.</figcaption> -->
          </figure>
        </div>
    </div>
  </div>
  </div>

<!--/ Paper video. -->
<!-- </div> -->
</section>

<!-- Bibtex -->
<section class="section" id="BibTeX">
  <div class="container is-max-desktop content">
    <h2 class="title" id="citation">BibTeX</h2>
    <span>If you find our work useful in your research, please consider citing:</span> 
    <pre><code>@article{singh2024negtome,
      title={Negative Token Merging: Image-based Adversarial Feature Guidance},
      author={Singh, Jaskirat and Li, Lindsey and Shi, Weijia and Krishna, Ranjay and Choi, Yejin and 
        Wei, Pang and Cohen, Michael and Gould, Stephen and Zheng, Liang and Zettlemoyer, Luke},
      journal={arXiv preprint arXiv},
      year={2024}
    }
  </code></pre>
  </div>
</section>

</section>
<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <a class="icon-link"
         href="https://homes.cs.washington.edu/~kpar/nerfies/videos/nerfies_paper.png">
        <i class="fas fa-file-pdf"></i>
      </a>
      <a class="icon-link" href="https://github.com/keunhong" class="external-link" disabled>
        <i class="fab fa-github"></i>
      </a>
    </div>
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p>
            This website is licensed under a <a rel="license"
                                                href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>
          <p>
            Website source code based on the <a
            href="https://github.com/nerfies/nerfies.github.io">Nerfies</a> project. If you want to reuse their source code, please credit them.
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

</body>
</html>