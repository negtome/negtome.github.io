<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="description"
        content="Negative Token Merging: Image-based Adversarial Feature Guidance">
  <meta name="keywords" content="token merging, negative token merging, diversity, copyright, negative prompt, diffusion models">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Negative Token Merging: Image-based Adversarial Feature Guidance</title>
  <!-- Global site tag (gtag.js) - Google Analytics
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PYVRSFMDRL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
      dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-PYVRSFMDRL');
  </script> -->

  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro"
        rel="stylesheet">

  <link rel="stylesheet" href="./static/css/bulma.min.css">
  <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
  <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
  <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
  <link rel="stylesheet" href="./static/css/index.css">
  <!-- <link rel="icon" href="./static/images/favicon.svg"> -->
  <link href="./static/images/icon.png" rel="icon" sizes="32x32" type="image/png">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script defer src="./static/js/fontawesome.all.min.js"></script>
  <script src="./static/js/bulma-carousel.min.js"></script>
  <script src="./static/js/bulma-slider.min.js"></script>
  <script src="./static/js/index.js"></script>
  <!-- <script src="./static/js/target.js"></script> -->
  <base target="_blank">
</head>
<body>


<!-- Navigation bar for visiting other research pages
<nav class="navbar" role="navigation" aria-label="main navigation">
  <div class="navbar-brand">
    <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
      <span aria-hidden="true"></span>
    </a>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start" style="flex-grow: 1; justify-content: center;">
      <a class="navbar-item" href="https://1jsingh.github.io/">
      <span class="icon">
          <i class="fas fa-home"></i>
      </span>
      </a>

      <div class="navbar-item has-dropdown is-hoverable">
        <a class="navbar-link">
          More Research
        </a>
        <div class="navbar-dropdown">
            <a class="navbar-item" href="https://1jsingh.github.io/divide-evaluate-and-refine">
                Eval-and-Refine (NeurIPS-2023)
            </a>
          <a class="navbar-item" href="https://1jsingh.github.io/gradop">
            GradOP-Guided-Image-Synthesis (CVPR-2023)
          </a>
          <a class="navbar-item" href="https://1jsingh.github.io/paint2pix">
            Paint2pix (ECCV-2022)
          </a>
          <a class="navbar-item" href="https://1jsingh.github.io/intelli-paint">
            Intelli-paint (ECCV-2022)
          </a>
          <a class="navbar-item" href="https://1jsingh.github.io/semantic-guidance">
            Semantic-Guidance (CVPR-2021)
          </a>
        </div>
      </div>
    </div>

  </div>
</nav> -->


<section class="hero">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <div class="columns is-centered">
        <div class="column has-text-centered">
          <h1 class="title is-1 publication-title"><span style="color: #007bff;"></span> Negative Token Merging: Image-based Adversarial Feature Guidance </h1>
          <div class="is-size-5 publication-authors">
            <div class="is-size-5 publication-authors">
              <!-- Author List -->
              <span class="author-block">
                <a href="https://1jsingh.github.io/">Jaskirat Singh</a><sup>2</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=WR875gYAAAAJ&hl=en">Lindsey Li</a><sup>1</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?hl=en&user=zt73PHcAAAAJ">Weijia Shi</a><sup>1</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://ranjaykrishna.com/index.html">Ranjay Krishna</a><sup>1,3</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=vhP-tlcAAAAJ&hl=en">Yejin Choi</a><sup>1</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://koh.pw/">Pang Wei Koh</a><sup>1,3</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://research.facebook.com/blog/2019/7/qa-with-director-of-computational-photography-michael-f-cohen/">Michael F. Cohen</a><sup>1</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com.au/citations?user=YvdzeM8AAAAJ&hl=en">Stephen Gould</a><sup>2</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=vNHqr3oAAAAJ&hl=en">Liang Zheng</a><sup>2</sup>&emsp;
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=UjpbO6IAAAAJ&hl=en">Luke Zettlemoyer</a><sup>1</sup>
              </span>
            </div>
            
            <div class="is-size-5 publication-authors">
              <!-- Institution List -->
              <span class="author-block"><sup>1</sup>University of Washington&emsp;&emsp;</span>
              <span class="author-block"><sup>2</sup>The Australian National University&emsp;&emsp;</span>
              <span class="author-block"><sup>3</sup>Allen Institute for AI</span>
            </div>

          <div class="column has-text-centered">
            <div class="publication-links">
              <!-- png Link. -->
              <!-- <span class="link-block">
                <a href=""
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                  </span>
                  <span>Paper</span>
                </a>
              </span> -->
              <!-- Arxiv Link. -->
              <span class="link-block">
                <a href="https://github.com/1jsingh/negtome"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="ai ai-arxiv"></i>
                  </span>
                  <span>Paper</span>
                </a>
              </span>
              <!-- Video Link. -->
              <!-- <span class="link-block">
                <a href="https://www.youtube.com/watch?v=Yk83RPCOa2o&ab_channel=anucvml"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-youtube"></i>
                  </span>
                  <span>Video</span>
                </a>
              </span> -->
              <!-- Demo Link. -->
              <span class="link-block">
                <a href="https://0ba0f871401453266b.gradio.live"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                    <i class="fas fa-paint-brush"></i>
                  </span>
                  <span>Hugginface Demo ðŸ¤—</span>
                </a>
              </span>
              <!-- Code Link. -->
              <span class="link-block">
                <a href="https://github.com/1jsingh/negtome"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="fab fa-github"></i>
                  </span>
                  <span>Code</span>
                  </a>
              </span>
              <!-- Dataset Link. -->
              <!-- <span class="link-block">
                <a target="_self" href="#citation"
                   class="external-link button is-normal is-rounded is-dark">
                  <span class="icon">
                      <i class="far fa-images"></i>
                  </span>
                  <span>Cite</span>
                </a>
              </span> -->
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>



<section class="hero teaser">
  <div class="container is-max-desktop">
    <div class="hero-body" text-align: center>
      <img src="./docs/overview-v1.jpg" width=100%/>  
      <!-- <video id="teaser" autoplay muted loop playsinline height="100%">
        <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/teaser.mp4"
                type="video/mp4">
      </video> -->
      <h2 class="has-text-justified">
        <!-- <br> -->
        <strong>Overview</strong>. We introduce <span style="font-style: italic;">NegToMe</span>, a 
        training-free approach for performing adversarial guidance directly using images instead of text (negative-prompt). 
        Above, we show its application for two prominent usecases: 1) Improving output diversity (e.g., visual, gender, racial), by guiding features of each image away from others (top).
        2) Reducing visual similarity with copyrighted characters, by guiding output features away from copyrighted images (bottom). Please refer below for further applications.
      </h2>
    </div>
  </div>
</section>


<!-- <section class="hero is-light is-small">
  <div class="hero-body">
    <div class="container">
      <div id="results-carousel" class="carousel results-carousel">
        <div class="item item-steve">
          <video poster="" id="steve" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/steve.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-chair-tp">
          <video poster="" id="chair-tp" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/chair-tp.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-shiba">
          <video poster="" id="shiba" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/shiba.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-fullbody">
          <video poster="" id="fullbody" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/fullbody.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-blueshirt">
          <video poster="" id="blueshirt" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/blueshirt.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-mask">
          <video poster="" id="mask" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/mask.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-coffee">
          <video poster="" id="coffee" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/coffee.mp4"
                    type="video/mp4">
          </video>
        </div>
        <div class="item item-toby">
          <video poster="" id="toby" autoplay controls muted loop playsinline height="100%">
            <source src="https://homes.cs.washington.edu/~kpar/nerfies/videos/toby2.mp4"
                    type="video/mp4">
          </video>
        </div>
      </div>
    </div>
  </div>
</section> -->

<!-- sample results -->
<section class="hero is-light is-small">
  <div class="hero-body">
    <div class="container is-max-desktop">
      <h3 class="subtitle has-text-centered">
        <b>Interactive Gallery (Output Diversity)</b>
      </h3>
      <div id="results-carousel" class="carousel results-carousel">
        <div class="item-simple item-steve">
          <img src="./docs/examples-6.jpg">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/examples-8.jpg">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/examples-5.jpg">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/examples-11.jpg">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/examples-9.jpg">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/examples-10.jpg">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/examples-1.jpg">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/examples-2.jpg">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/examples-7.jpg">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/examples-3.jpg">
        </div>
        <div class="item-simple item-steve">
          <img src="./docs/examples-4.jpg">
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container is-max-desktop">
    <!-- Abstract. -->
    <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <br><br><h2 class="title is-3">Abstract</h2>
        <div class="content has-text-justified">
          <p>
            Text-based adversarial guidance using a negative prompt has emerged as a widely adopted approach to push the output features away from undesired concepts. 
            <strong>While useful, performing adversarial guidance using text alone can be insufficient to capture complex visual concepts and avoid undesired visual elements like copyrighted characters. </strong>
            In this paper, for the first time we explore an alternate modality in this direction by performing adversarial guidance directly using visual features from a reference image or other images in a batch. 
            In particular, we introduce negative token merging (NegToMe), a simple but effective training-free approach which performs adversarial guidance by selectively pushing apart matching semantic features (between reference and output generation) during the reverse diffusion process. 
            When used w.r.t. other images in the same batch, we observe that NegToMe significantly increases output diversity (racial, gender, visual) without sacrificing output image quality. Similarly, when used w.r.t. a reference copyrighted asset, NegToMe helps reduce visual similarity with copyrighted content by 34.57%. 
            NegToMe is simple to implement using just few-lines of code, uses only marginally higher (<4%) inference times and generalizes to different diffusion architectures like Flux, which do not natively support the use of a separate negative prompt.
          </p>
          <p>
            <strong>TLDR;</strong> We propose an alternate modality to traditional text (negative-prompt) based adversarial guidance, by <strong>directly using visual features from a reference image</strong> to guide the generation process. 
          </p>
        </div>
      </div>
    </div>
    <!--/ Abstract. -->

    <!-- Paper video. -->
    <!-- <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">Video</h2>
        <div class="publication-video">
          <iframe src="https://www.youtube.com/embed/MrKrnHhk8IA?rel=0&amp;showinfo=0"
                  frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
      </div>
    </div> -->
    <!--/ Paper video. -->
</section>


<!-- other sections -->
<section class="hero">
<!-- Paper video. -->
<div class="hero-body is-small">
<div class="container alternate-section">
  <div class="columns is-centered has-text-centered">
      <div class="column is-four-fifths">
        <h2 class="title is-3">How does NegToMe work?</h2>
        <figure>
          <img src="./docs/method-overview-v1.jpg" width="100%" alt="Method Overview of NegToMe"/>
          <!-- <figcaption style="text-align:justify;">
            <strong>Method Overview.</strong> The core idea of NegToMe is to perform adversarial guidance directly using visual features from a reference image (or other images in the same batch). NegToMe is simple and can be applied in any transformer block. A simple three-step process is used for performing adversarial guidance using NegToMe.
          </figcaption> -->
        </figure>
        <div style="display: flex; align-items: center; justify-content: center;">
          <figure style="margin: 0; flex: 1;">
            <img src="./docs/alg-v1.jpg" width="60%" alt="Method Overview of NegToMe" style="display: block; margin: auto;" />
          </figure>
          <figcaption style="text-align:justify; margin-left: 20px; flex: 1;">
            <strong>Method Overview (up).</strong> (a) The core idea of NegToMe is to perform adversarial guidance directly using visual features from a reference image (or other images in the same batch). (b) NegToMe is simple and can be applied in any transformer block. (c) A simple three-step process is used for performing adversarial guidance using NegToMe.
            <br><br>
            <strong>Implementation (left).</strong> NegToMe can be incorporated in most diffusion models using just a few lines of code.
          </figcaption>
        </div>
      </div>
  </div>
</div>
</div>

<div class="hero-body is-small">
  <div class="container">
    <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Improving Output Diversity (Flux)</h2>
          <!-- <p style="text-align:justify"><b>Comparison with only negative prompt based mitigation</b> 
              <br><br> </p> -->
          <figure>
            <img src="./docs/flux-v2.jpg" width=100%/>
            <!-- <figcaption>Fig.1 - Trulli, Puglia, Italy.</figcaption> -->
          </figure>
        </div>
    </div>
  </div>
</div>

<div class="hero-body is-small ">
  <div class="container alternate-section">
    <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Improving Output Diversity (SDXL)</h2>
          <!-- <p style="text-align:justify"><b>Comparison with only negative prompt based mitigation</b> 
              <br><br> </p> -->
          <figure>
            <img src="./docs/diversity-sdxl-v1.jpg" width=100%/>
            <!-- <figcaption>Fig.1 - Trulli, Puglia, Italy.</figcaption> -->
          </figure>
        </div>
    </div>
  </div>
</div>



<div class="hero-body is-small">
  <div class="container alternate-section">
    <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Copyright Mitigation</h2>
          <!-- <p style="text-align:justify"><b>Comparison with only negative prompt based mitigation</b> 
              <br><br> </p> -->
          <figure>
            <img src="./docs/copyright-v1.jpg" width=100%/>
            <!-- <figcaption>Fig.1 - Trulli, Puglia, Italy.</figcaption> -->
            <figcaption style="text-align:justify;">
              <strong>Copyright Mitigation.</strong> state-of-the-art diffusion models (SDXL, Flux) can generate copyrighted characters even if the input-prompt does not explicitly mention the character name. Furthermore, performing copyright mitigation using negative prompt (i.e., adding character name to negative prompt) is often
              insufficient. NegToMe helps better reduce similarity with copyrighted characters by directly using visual features from a copyrighted retrieval database for adversarial guidance.
            </figcaption>
          </figure>
        </div>
    </div>
  </div>
</div>


<div class="hero-body is-small">
  <div class="container alternate-section">
    <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Improving Output Aesthetics and Details</h2>
          <!-- <p style="text-align:justify"><b>Comparison with only negative prompt based mitigation</b> 
              <br><br> </p> -->
          <figure>
            <img src="./docs/output-quality-v2.jpg" width=100%/>
            <figcaption style="text-align:justify;">
              <strong>Output Aesthetics.</strong> Simply using a blurry reference with NegToMe improves output aesthetics / details without any finetuning.
            </figcaption>
          </figure>
        </div>
    </div>
  </div>
</div>


<div class="hero-body is-small">
  <div class="container alternate-section">
    <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Cross-Domain Adversarial Guidance</h2>
          <!-- <p style="text-align:justify"><b>Comparison with only negative prompt based mitigation</b> 
              <br><br> </p> -->
          <figure>
            <img src="./docs/cross-domain-v2.jpg" width=100%/>
            <figcaption style="text-align:justify;">
              <!-- <strong>Cross-domain guidance.</strong>  -->
              NegToMe can also be used for adversarial guidance using cross-domain reference images (eg, sketch-to-photo in above).
            </figcaption>
          </figure>
        </div>
    </div>
  </div>
</div>


<div class="hero-body is-small">
  <div class="container alternate-section">
    <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <h2 class="title is-3">Adversarial Guidance for Style</h2>
          <!-- <p style="text-align:justify"><b>Comparison with only negative prompt based mitigation</b> 
              <br><br> </p> -->
          <figure>
            <img src="./docs/style-guidance-v1.jpg" width=100%/>
            <figcaption style="text-align:justify;">
              <!-- <strong>Cross-domain guidance.</strong>  -->
              NegToMe can also be used for style guidance: excluding specific artistic elements while still mainting desired image content. For instance, in above example the user wants <strong>a painting of a starry night</strong> without artistic elements from van-gogh style. 
            </figcaption>
          </figure>
        </div>
    </div>
  </div>
</div>



<!--/ Paper video. -->
<!-- </div> -->
</section>

<!-- Bibtex -->
<section class="section" id="BibTeX">
  <div class="container is-max-desktop content">
    <h2 class="title" id="citation">BibTeX</h2>
    <span>If you find our work useful in your research, please consider citing:</span> 
    <pre><code>@article{singh2024negtome,
      title={Negative Token Merging: Image-based Adversarial Feature Guidance},
      author={Singh, Jaskirat and Li, Lindsey and Shi, Weijia and Krishna, Ranjay and Choi, Yejin and 
        Wei, Pang and Cohen, Michael and Gould, Stephen and Zheng, Liang and Zettlemoyer, Luke},
      journal={arXiv preprint arXiv},
      year={2024}
    }
  </code></pre>
  </div>
</section>

</section>
<footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <a class="icon-link"
         href="https://homes.cs.washington.edu/~kpar/nerfies/videos/nerfies_paper.png">
        <i class="fas fa-file-pdf"></i>
      </a>
      <a class="icon-link" href="https://github.com/keunhong" class="external-link" disabled>
        <i class="fab fa-github"></i>
      </a>
    </div>
    <div class="columns is-centered">
      <div class="column is-8">
        <div class="content">
          <p>
            This website is licensed under a <a rel="license"
                                                href="http://creativecommons.org/licenses/by-sa/4.0/">Creative
            Commons Attribution-ShareAlike 4.0 International License</a>.
          </p>
          <p>
            Website source code based on the <a
            href="https://github.com/nerfies/nerfies.github.io">Nerfies</a> project. If you want to reuse their source code, please credit them.
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

</body>
</html>